---
title: 内存取证
description: 
published: true
date: 2022-07-17T02:53:10.353Z
tags: 
editor: markdown
dateCreated: 2022-07-11T01:28:40.096Z
---

内存取证是针对靶机的内存镜像进行取证分析，其中最常用到的工具便是`Volatility`，是一个开源的内存取证框架。内存取证的核心便是针对进程列表进行分析，并结合题目题干查询敏感数据。

针对内存取证，实战中第一步就是针对靶机的内存提取，对Windows来说，可以通过`DumpIt.exe`来实现，而Linux和Macos则需要使用 [lmg](https://github.com/halpomeranz/lmg) 和 `dwarfdump` 来实现。而在安全研究和CTF比赛中，内存镜像也有可能是从`VMware`虚拟机快照文件中所提取出来的。虽然文件的结构和取材途径不同，但是其中的内存数据都是一致的，也都可以利用Volatility来进行分析。

成功得到靶机的内存镜像后，就需要先确定内存的数据结构和格式，这在`Volatility`中已经实现简单化操作，只需指定profile就可以套用已有结构进行分析（针对Linux内存镜像，可能需要针对靶机的结构和平台，自己编译一份profile）。目前，`Volatility`有两个版本分支，分别是`Volatility2`（Volatility 2.7）和`Volatility3`。

就目前而言，`Volatility3`在检材数据结构分析自动识别，以及分析速度上。相较于`Volatility2`有了非常巨大的提升，但是对于功能数量和第三方插件数量而言，`Volatility3`还不是很成熟。故建议一般情况下还是使用`Volatility2`来进行内存镜像研究。

`Volatility`的相关使用语法可以参考`-h`中的帮助信息，也可以参考`狼组安全团队公开知识库`中的文章。 

- [获取Volatility](/forensic/memory-analysis/install_volatility)
- [狼组安全团队公开知识库-Volatility取证分析工具](https://wiki.wgpsec.org/knowledge/ctf/Volatility.html)
{.links-list}

# 内存镜像分析基本流程
## 确定平台和内核版本
## 初步信息收集
## 常见的敏感进程

# 内存取证的出题姿势
这一块其实没必要深究，因为如果手头有商业性的取证框架的话的话，基本是可以梭哈的，但是为了一般情景，还是有必要探究常见的内存取证的姿势，以及相对应的出题方式，学会手撸出flag。

## 文件数据

这一步主要是靶机在加载文件的时候，内存中的缓存还没有清空的时候，内存被提取出了镜像。但是这一块有一个重点，那就是在文件加载的时候，文件数据会出现在多个位置，例如文件缓存区，剪贴板，亦或者加载文件的程序内存中。这样子就大大增加了数据提取出来的可能性。这就需要考虑文件应该如何加载到内存中，并且使得文件数据的打开范围进行一个控制。

常见的出题形式有`.txt`、`.zip`、`.rar`等等，并且一般都会有一定的特征，提示其具有分析的价值，例如文件就存放在用户的桌面上。（如 `grep “Desktop”`），这时候就可以对常见的位置进行一个初步的筛选，来快速判断有无有价值信息。

对于文件的加载，最为常见的就是打开文件后迅速开始创建内存镜像。因为在打开文件后接着进行其他操作，系统会有一定概率对内存进行重新分布（尤其是小内存的情况下），使得最终出来的内存镜像中失去了文件数据，这也要求出题后必须要对内存镜像的可解性进行验证。

## 程序数据

这一块相对棘手，因为当程序加载到内存中了之后，其相对应的程序结构和数据有可能发生变化（尤其是像带有压缩壳的程序，在运行的时候会将程序数据进行一个解压操作，会增加对程序源码分析的难度），并且在小内存的情况下，有可能会发生内存布局混乱的情况。在`Volatility`中直接`memdump`出来的数据是指程序所有的可寻址内存，包括程序主体以及所有它所访问的资源，而`procdump`则是dump下来程序本体的二进制数据，但是不一定是程序的原始二进制数据，在加载到内存的过程中会脱壳、解压、释放内存等等，这也使得常规的内存取证的题目中，一般很少会出藏在程序源码中的问题，而大多都是以程序内存中的文件数据来出题。

对于程序内存中的文件数据，常见于程序在加载文件时的情景，例如压缩软件尝试解压文件的过程中，又或者用`GIMP`打开图像，这些操作都有可能让文件数据进入到程序内存中，进而被写入内存镜像。

近年来，取证的题目与实战分析走的越来越近，尤其是针对渗透后的痕迹分析，以及勒索攻击的分析与溯源，都在成为中高难度取证题目的核心，也就使得对内存中的程序行为及二进制数据的分析也要开始掌握。

## 剪贴板

## 注册表

## 命令行历史记录